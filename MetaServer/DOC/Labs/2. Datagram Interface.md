
# Лабораторная работа № 2
***
Задача: Протестировать возможности Datagram
***
Чему вы научитесь в лабораторной работе:

***
Что используется при решении задачи:

***
## Шаг 1. Pushdown-оптимизация

>##### №1
1. Перейти в раздел ![](img/Common/home.PNG) / ETL / Project / labWorks / tr_salary_step2
2. Справа сверху навести на плюсик и выбрать Source Code Editor
3. Выбрать:
   - Tab "Step"
   - Select server: db-livy
   - Step: tableFactUp (Join)
4. ![](img/Common/load.PNG) Нажать Load code
5. ![](img/Common/run.PNG) Нажать Run
6. Подождать, пока запрос отработает и вернет результат

>##### №2
1. Изменить количество строк данных в результирующей таблице:   
   - В конце кода найти строку:
         ```
         tableFactUp.show(20, false)
         ```
   - Заменить 20 на 200:
         ```
         tableFactUp.show(200, false)
         ```
   - ![](img/Common/run.PNG) Нажать Run
   - Убедиться, что в результате вернулось 200 строк, вместо 20


>##### №3

1. Вывести только физический план запроса:
   - Заменить функцию с show() на explain():
         ```
         tableFactUp.explain()
         ```
   - ![](img/Common/run.PNG) Нажать Run
   - В результирующем поле:
      - Physical Plan

> Physical Plan - Фактический план исполнения кода на Spark. В нем есть метаданные

>##### №4

1. Вывести все планы запроса:
   - Заменить функцию с explain() на explain(true):
           ```
           tableFactUp.explain(true)
           ```
   - ![](img/Common/run.PNG) Нажать Run
   - В результирующем поле:
      - Parsed Logical Plan
      - Analyzed Logical Plan
      - Optimized Logical Plan
      - Physical Plan   

> - Parsed Logical Plan - План запроса 1:1 как он есть в коде на Spark, в трансформации. 
> - Analyzed Logical Plan - Подробный план запроса 1:1
> - Optimized Logical Plan - Оптимизированный план. Spark изменяет последовательность выполнения этапов трансформации для снижения нагрузки и времени отработки запроса


>##### №4